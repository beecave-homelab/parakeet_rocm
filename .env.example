# Runtime environment overrides for Parakeet-NeMo ASR (ROCm)
# These values are picked up at process start by utils.env_loader

#------------------------------------------------------------------------------
# Chunking length for handling large files and limited VRAM
#------------------------------------------------------------------------------

# Chunking length for handling large files and limited VRAM available
CHUNK_LEN_SEC=120
# Low-latency chunk length (seconds) for pseudo-streaming mode
STREAM_CHUNK_SEC=6

# Default batch size for model inference
BATCH_SIZE=1

# Parakeet ASR model to load (NGC or HF identifier)
# Default: nvidia/parakeet-tdt-0.6b-v2
# Multilingual: nvidia/parakeet-tdt-0.6b-v3
PARAKEET_MODEL_NAME=nvidia/parakeet-tdt-0.6b-v3

# Prefer FFmpeg for audio decoding (1 = use FFmpeg first, 0 = try soundfile first)
FORCE_FFMPEG=1

# Allow filenames with spaces, brackets, quotes, and other non-ASCII characters.
# Security invariants (path traversal, directory separators, control characters)
# remain enforced regardless of this setting. Cross-platform filesystem
# compatibility is NOT guaranteed when enabled.
# Default: False (strict allowlist: letters, digits, '_', '-')
ALLOW_UNSAFE_FILENAMES=False

#------------------------------------------------------------------------------
# Subtitle readability constraints (industry-standard defaults)
#------------------------------------------------------------------------------
# Default safe root for subtitle I/O confinement
# Default: /path/to/repo/output
SRT_SAFE_ROOT=/path/to/repo/output

# Characters-per-second upper bound for readable captions
MAX_CPS=14
# Lower CPS bound (useful for extremely short segments)
MIN_CPS=12
# Maximum characters per subtitle line
MAX_LINE_CHARS=42
# Maximum lines per subtitle block
MAX_LINES_PER_BLOCK=3
# Additional display buffer (seconds) after the last word finishes
DISPLAY_BUFFER_SEC=0.2

# Minimum and maximum segment display durations
# Minimum subtitle display duration (seconds) - tightened for pacing
MIN_SEGMENT_DURATION_SEC=1.5
# Maximum subtitle display duration (seconds) - slightly reduced for fast narration
MAX_SEGMENT_DURATION_SEC=6

# Hard and soft block character limits
# Hard limit: typically 2 Ã— MAX_LINE_CHARS (keep unchanged unless you know why)
MAX_BLOCK_CHARS=84
# Soft limit used when evaluating merges; allows slight overflow for better flow
MAX_BLOCK_CHARS_SOFT=90

# Soft boundary keywords (comma-separated, lowercase) treated as optional cue splits
SOFT_BOUNDARY_WORDS=and,but,that,which,who,where,when,while,so
# Whitelisted interjections allowed to remain as very short standalone cues
INTERJECTION_WHITELIST=whoa,wow,what,oh,hey,ah

LD_LIBRARY_PATH=/opt/rocm/lib:/opt/rocm/lib64

# PyTorch ROCm memory allocation configuration to reduce fragmentation on AMD GPUs.
# max_split_size_mb:128 is a sensible default for 8GB-16GB VRAM.
# For 4GB VRAM, consider reducing to 64. For 24GB+, can be increased to 256 or 512.
#
# The application automatically detects the PyTorch version and sets the correct
# environment variable:
# - PyTorch < 2.9.0: Uses PYTORCH_HIP_ALLOC_CONF
# - PyTorch >= 2.9.0: Uses PYTORCH_ALLOC_CONF
#
# You can set either variable (or both) in your .env file. The application will
# use the first one found. Sensible defaults are applied automatically if not specified.
#
# Example (recommended):
# PYTORCH_ALLOC_CONF=garbage_collection_threshold:0.7,max_split_size_mb:128
#
# Or for older PyTorch versions:
# PYTORCH_HIP_ALLOC_CONF=garbage_collection_threshold:0.7,max_split_size_mb:128

# GFX override for patching ROCm / HIP AMD GPU support (uncomment if needed)
# HSA_OVERRIDE_GFX_VERSION=10.3.0

# Useful when you're diagnosing issues like invalid memory access,
# illegal instructions, or kernel launch failures
# HIP_LAUNCH_BLOCKING=1

# Disable Numba JIT to avoid additional GPU memory usage (optional: uncomment if needed)
# NEUTRON_NUMBA_DISABLE_JIT=1

#------------------------------------------------------------------------------
# Logging configuration
#------------------------------------------------------------------------------
NEMO_LOG_LEVEL=ERROR
TRANSFORMERS_VERBOSITY=error

#------------------------------------------------------------------------------
# Runtime memory management
#------------------------------------------------------------------------------
# Offload the cached model to CPU after this many seconds of inactivity when
# running in watch mode (frees GPU VRAM while keeping weights in host RAM).
# Default: 300 seconds (5 minutes)
IDLE_UNLOAD_TIMEOUT_SEC=300

# Fully clear model cache after this many seconds of inactivity to reduce host
# RAM usage (forces full reload on next job). Default: 360 seconds (6 minutes)
IDLE_CLEAR_TIMEOUT_SEC=360

#------------------------------------------------------------------------------
# Gradio WebUI configuration
#------------------------------------------------------------------------------
# Launch WebUI with: parakeet-rocm webui
#
# WebUI theme colors (Gradio Soft hues)
# Supported hue names: slate, gray, zinc, neutral, stone, red, orange, amber,
# yellow, lime, green, emerald, teal, cyan, sky, blue, indigo, violet, purple,
# fuchsia, pink, rose
#
# Primary hue controls action elements like buttons
WEBUI_PRIMARY_HUE=indigo
# Secondary hue supports accent components
WEBUI_SECONDARY_HUE=slate
# Neutral hue is used for backgrounds and borders
WEBUI_NEUTRAL_HUE=slate

# Server port for Gradio WebUI (default: 7861)
GRADIO_SERVER_PORT=7861
#
# Server hostname/IP to bind to:
#   "0.0.0.0" = all interfaces (accessible from network)
#   "127.0.0.1" = localhost only (local machine access only)
GRADIO_SERVER_NAME=0.0.0.0
#
# Enable Gradio analytics tracking (default: False for privacy)
GRADIO_ANALYTICS_ENABLED=False

#------------------------------------------------------------------------------
# OpenAI-compatible REST API configuration
#------------------------------------------------------------------------------
# Enable OpenAI-compatible API routes (for example /v1/audio/transcriptions).
# Default: True
API_ENABLED=True

# Server hostname/IP to bind the API service to.
# Default: value of GRADIO_SERVER_NAME when API_SERVER_NAME is not set.
API_SERVER_NAME=0.0.0.0

# Default server port for the API command (default: 8080)
API_SERVER_PORT=8080

# Comma-separated list of allowed CORS origins for the REST API.
# Example: API_CORS_ORIGINS=http://localhost:3000,https://example.com
# Empty value disables CORS middleware.
API_CORS_ORIGINS=

#------------------------------------------------------------------------------
# Timezone
#------------------------------------------------------------------------------
TZ="Europe/Amsterdam"

#------------------------------------------------------------------------------
# Benchmark collection configuration
#------------------------------------------------------------------------------
# Enable persistent benchmark metrics collection (runtime, GPU stats, quality)
# When enabled, metrics are written to JSON files in the output directory.
# Default: False (opt-in)
BENCHMARK_PERSISTENCE_ENABLED=False

# GPU sampling interval in seconds for utilization/VRAM telemetry.
# Lower values = more frequent sampling (higher overhead).
# Requires pyamdgpuinfo to be installed for AMD ROCm GPUs.
# Default: 1.0 second
GPU_SAMPLER_INTERVAL_SEC=1.0

# Directory for storing benchmark JSON files.
# Default: /app/data/benchmarks (Docker container path)
BENCHMARK_OUTPUT_DIR=/app/data/benchmarks
