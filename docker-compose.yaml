services:
  parakeet-rocm-webui:
    build:
      context: .
      dockerfile: Dockerfile
    image: parakeet-rocm:latest
    container_name: parakeet-rocm-webui
    ports:
      # Gradio WebUI
      - "${GRADIO_SERVER_PORT:-7861}:${GRADIO_SERVER_PORT:-7861}"
    env_file:
      - .env
    devices:
      - "/dev/kfd"
      - "/dev/dri"
    group_add:
      - "video"
    volumes:
      - "/opt/rocm:/opt/rocm:ro"
      - "./data:/app/data"
      - "./parakeet_rocm:/app/parakeet_rocm"
    # Run in debug mode
    # command: ["parakeet-rocm", "webui", "--host", "${GRADIO_SERVER_NAME:-0.0.0.0}", "--port", "${GRADIO_SERVER_PORT:-7861}", "--debug"]
    # Run in normal mode
    command: ["parakeet-rocm", "webui", "--host", "${GRADIO_SERVER_NAME:-0.0.0.0}", "--port", "${GRADIO_SERVER_PORT:-7861}"]
    restart: unless-stopped

  parakeet-rocm-api:
    # reuse built image, no build block
    image: parakeet-rocm:latest
    container_name: parakeet-rocm-api
    ports:
      # OpenAI-compatible REST API
      - "${API_SERVER_PORT:-8080}:${API_SERVER_PORT:-8080}"
    env_file:
      - .env
    devices:
      - "/dev/kfd"
      - "/dev/dri"
    group_add:
      - "video"
    volumes:
      - "/opt/rocm:/opt/rocm:ro"
      - "./data:/app/data"
      - "./parakeet_rocm:/app/parakeet_rocm"
    # Run in debug mode
    # command: ["parakeet-rocm", "api", "--host", "${API_SERVER_NAME:-0.0.0.0}", "--port", "${API_SERVER_PORT:-8080}", "--debug"]
    # Run in normal mode
    command: ["parakeet-rocm", "api", "--host", "${API_SERVER_NAME:-0.0.0.0}", "--port", "${API_SERVER_PORT:-8080}"]
    restart: unless-stopped
